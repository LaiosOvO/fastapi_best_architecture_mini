# 接口规范文档

## 设计原则

参考 [ruoyi-vue-pro](https://github.com/YunaiV/ruoyi-vue-pro) 的接口规范，确保接口的一致性和规范性。

## 通用响应格式

### 成功响应
```json
{
  "code": 0,
  "data": {
    // 具体数据
  },
  "msg": "操作成功"
}
```

### 分页响应
```json
{
  "code": 0,
  "data": {
    "list": [
      // 数据列表
    ],
    "total": 100
  },
  "msg": "查询成功"
}
```

### 错误响应
```json
{
  "code": 500,
  "data": null,
  "msg": "系统异常"
}
```

## 错误码定义

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 401 | 未认证 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 系统异常 |
| 1001 | 参数错误 |
| 1002 | 数据已存在 |
| 1003 | 数据不存在 |

## 系统管理接口

### 用户管理

#### 用户分页查询
```
GET /api/v1/system/user/page
```

**请求参数**：
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page_no | int | 否 | 页码，默认1 |
| page_size | int | 否 | 每页数量，默认10 |
| username | string | 否 | 用户名（模糊查询） |
| mobile | string | 否 | 手机号（模糊查询） |
| status | int | 否 | 状态（0正常 1停用） |
| create_time | string[] | 否 | 创建时间范围 |

**响应示例**：
```json
{
  "code": 0,
  "data": {
    "list": [
      {
        "id": 1,
        "username": "admin",
        "nickname": "管理员",
        "email": "admin@example.com",
        "mobile": "13800138000",
        "sex": 1,
        "avatar": "",
        "status": 0,
        "login_ip": "127.0.0.1",
        "login_date": "2024-01-01 12:00:00",
        "create_time": "2024-01-01 00:00:00",
        "update_time": "2024-01-01 00:00:00"
      }
    ],
    "total": 1
  },
  "msg": "查询成功"
}
```

#### 用户详情
```
GET /api/v1/system/user/get?id={id}
```

#### 创建用户
```
POST /api/v1/system/user/create
```

**请求体**：
```json
{
  "username": "testuser",
  "nickname": "测试用户",
  "email": "test@example.com",
  "mobile": "13800138001",
  "sex": 1,
  "password": "123456",
  "role_ids": [2],
  "dept_id": 100
}
```

#### 更新用户
```
PUT /api/v1/system/user/update
```

#### 删除用户
```
DELETE /api/v1/system/user/delete?id={id}
```

### 角色管理

#### 角色分页查询
```
GET /api/v1/system/role/page
```

#### 角色列表（简单）
```
GET /api/v1/system/role/list-all-simple
```

#### 创建角色
```
POST /api/v1/system/role/create
```

#### 更新角色
```
PUT /api/v1/system/role/update
```

#### 删除角色
```
DELETE /api/v1/system/role/delete?id={id}
```

### 菜单管理

#### 菜单树形列表
```
GET /api/v1/system/menu/list
```

#### 创建菜单
```
POST /api/v1/system/menu/create
```

#### 更新菜单
```
PUT /api/v1/system/menu/update
```

#### 删除菜单
```
DELETE /api/v1/system/menu/delete?id={id}
```

### 部门管理

#### 部门树形列表
```
GET /api/v1/system/dept/list
```

## 认证接口

### 用户登录
```
POST /api/v1/system/auth/login
```

**请求体**：
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**响应**：
```json
{
  "code": 0,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_time": 1704067200000
  },
  "msg": "登录成功"
}
```

### 用户登出
```
POST /api/v1/system/auth/logout
```

### 获取用户信息
```
GET /api/v1/system/auth/get-permission-info
```

**响应**：
```json
{
  "code": 0,
  "data": {
    "user": {
      "id": 1,
      "username": "admin",
      "nickname": "管理员",
      "email": "admin@example.com",
      "mobile": "13800138000",
      "sex": 1,
      "avatar": "",
      "status": 0
    },
    "roles": ["admin"],
    "permissions": ["system:user:list", "system:user:create"],
    "menus": [
      {
        "id": 1,
        "name": "系统管理",
        "path": "/system",
        "component": "system/index",
        "icon": "system",
        "children": []
      }
    ]
  },
  "msg": "获取成功"
}
```

## 基础设施接口

### 文件上传
```
POST /api/v1/infra/file/upload
```

**请求**：multipart/form-data
- file: 文件对象

**响应**：
```json
{
  "code": 0,
  "data": {
    "url": "http://localhost:8080/admin-api/infra/file/xxx/get",
    "fileName": "xxx.jpg"
  },
  "msg": "上传成功"
}
```

### 代码生成
```
POST /api/v1/infra/codegen/create-list
```

## AI 集成接口

### AI 对话
```
POST /api/v1/ai/chat/send-message
```

**请求体**：
```json
{
  "conversation_id": "conv_123",
  "message": "你好"
}
```

**响应**：
```json
{
  "code": 0,
  "data": {
    "conversation_id": "conv_123",
    "reply": "你好！有什么可以帮助您的吗？",
    "message_id": "msg_456"
  },
  "msg": "对话成功"
}
```

### 流式对话（SSE）
```
POST /api/v1/ai/chat/send-message-stream
```

## 数据权限

### 数据范围类型
- **1**：全部数据权限
- **2**：自定义数据权限
- **3**：本部门数据权限
- **4**：本部门及以下数据权限
- **5**：仅本人数据权限

### 请求头
所有需要认证的接口都需要在请求头中携带：
```
Authorization: Bearer {token}
```

### 分页参数
所有分页接口都支持以下参数：
| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| page_no | int | 1 | 页码 |
| page_size | int | 10 | 每页数量 |

### 排序参数
支持多种排序方式：
| 参数名 | 类型 | 说明 |
|--------|------|------|
| order_by | string | 排序字段 |
| order_dir | string | 排序方向：asc/desc |