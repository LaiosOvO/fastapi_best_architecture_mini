# 数据库部署指南

> 数据根目录: `/Volumes/T7/programe/env/docker`
>
> 配置文件: `scripts/docker-compose-database.yml`

## 快速开始

```bash
# 进入 scripts 目录
cd scripts

# 启动单个服务
docker-compose -f docker-compose-database.yml up -d <service_name>

# 启动多个服务
docker-compose -f docker-compose-database.yml up -d mysql redis mongodb

# 停止服务
docker-compose -f docker-compose-database.yml stop <service_name>

# 删除服务
docker-compose -f docker-compose-database.yml down <service_name>

# 查看日志
docker-compose -f docker-compose-database.yml logs -f <service_name>

# 查看运行状态
docker-compose -f docker-compose-database.yml ps
```

---

## 关系型数据库

### MySQL 8.0

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d mysql

# 连接
mysql -h 127.0.0.1 -P 3306 -u root -p123456
mysql -h 127.0.0.1 -P 3306 -u fba_user -p123456 fba
```

| 配置项 | 值 |
|--------|------|
| 端口 | 3306 |
| Root密码 | 123456 |
| 用户名 | fba_user |
| 密码 | 123456 |
| 数据库 | fba |
| 数据目录 | `/Volumes/T7/programe/env/docker/mysql/data` |

**Python 连接示例:**
```python
# pip install pymysql
DATABASE_URL = "mysql+pymysql://fba_user:123456@127.0.0.1:3306/fba?charset=utf8mb4"

# pip install aiomysql (异步)
DATABASE_URL = "mysql+aiomysql://fba_user:123456@127.0.0.1:3306/fba?charset=utf8mb4"
```

---

### PostgreSQL 15

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d postgres

# 连接
psql -h 127.0.0.1 -p 5432 -U postgres -d fba
```

| 配置项 | 值 |
|--------|------|
| 端口 | 5432 |
| 用户名 | postgres |
| 密码 | 123456 |
| 数据库 | fba |
| 数据目录 | `/Volumes/T7/programe/env/docker/postgres/data` |

**Python 连接示例:**
```python
# pip install psycopg2-binary
DATABASE_URL = "postgresql://postgres:123456@127.0.0.1:5432/fba"

# pip install asyncpg (异步)
DATABASE_URL = "postgresql+asyncpg://postgres:123456@127.0.0.1:5432/fba"
```

---

### MariaDB 10.11

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d mariadb

# 连接
mysql -h 127.0.0.1 -P 3307 -u root -p123456
```

| 配置项 | 值 |
|--------|------|
| 端口 | 3307 |
| Root密码 | 123456 |
| 用户名 | fba_user |
| 密码 | 123456 |
| 数据库 | fba |
| 数据目录 | `/Volumes/T7/programe/env/docker/mariadb/data` |

---

### SQLite

SQLite 是文件数据库，无需 Docker 部署，直接在应用中使用即可。

**Python 连接示例:**
```python
# 内置支持，无需安装
DATABASE_URL = "sqlite:///./fba.db"

# 异步: pip install aiosqlite
DATABASE_URL = "sqlite+aiosqlite:///./fba.db"
```

---

## NoSQL 数据库

### MongoDB 7.0

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d mongodb

# 连接
mongosh "mongodb://root:123456@127.0.0.1:27017/fba?authSource=admin"
```

| 配置项 | 值 |
|--------|------|
| 端口 | 27017 |
| 用户名 | root |
| 密码 | 123456 |
| 数据库 | fba |
| 数据目录 | `/Volumes/T7/programe/env/docker/mongodb/data` |

**Python 连接示例:**
```python
# pip install pymongo
from pymongo import MongoClient
client = MongoClient("mongodb://root:123456@127.0.0.1:27017/fba?authSource=admin")

# pip install motor (异步)
from motor.motor_asyncio import AsyncIOMotorClient
client = AsyncIOMotorClient("mongodb://root:123456@127.0.0.1:27017/fba?authSource=admin")
```

---

### Redis 7

```bash
# 启动 (无密码)
docker-compose -f docker-compose-database.yml up -d redis

# 启动 (带密码)
docker-compose -f docker-compose-database.yml up -d redis-auth

# 连接
redis-cli -h 127.0.0.1 -p 6379
redis-cli -h 127.0.0.1 -p 6380 -a 123456
```

| 配置项 | 无密码版 | 带密码版 |
|--------|----------|----------|
| 端口 | 6379 | 6380 |
| 密码 | 无 | 123456 |
| 数据目录 | `/Volumes/T7/programe/env/docker/redis/data` | `/Volumes/T7/programe/env/docker/redis-auth/data` |

**Python 连接示例:**
```python
# pip install redis
import redis
r = redis.Redis(host='127.0.0.1', port=6379, db=0)

# 带密码
r = redis.Redis(host='127.0.0.1', port=6380, password='123456', db=0)

# pip install aioredis (异步)
import aioredis
r = await aioredis.from_url("redis://127.0.0.1:6379/0")
```

---

### Memcached

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d memcached

# 测试连接
echo "stats" | nc localhost 11211
```

| 配置项 | 值 |
|--------|------|
| 端口 | 11211 |
| 内存限制 | 256MB |

**Python 连接示例:**
```python
# pip install pymemcache
from pymemcache.client import base
client = base.Client(('127.0.0.1', 11211))
```

---

## 搜索引擎

### Elasticsearch 8.x

```bash
# 启动 (无认证)
docker-compose -f docker-compose-database.yml up -d elasticsearch

# 启动 (带认证)
docker-compose -f docker-compose-database.yml up -d elasticsearch-secure

# 测试连接
curl http://127.0.0.1:9200
curl -u elastic:123456 http://127.0.0.1:9201
```

| 配置项 | 无认证版 | 带认证版 |
|--------|----------|----------|
| HTTP端口 | 9200 | 9201 |
| TCP端口 | 9300 | 9301 |
| 用户名 | - | elastic |
| 密码 | - | 123456 |
| 数据目录 | `/Volumes/T7/programe/env/docker/elasticsearch/data` | `/Volumes/T7/programe/env/docker/elasticsearch-secure/data` |

**Python 连接示例:**
```python
# pip install elasticsearch
from elasticsearch import Elasticsearch
es = Elasticsearch("http://127.0.0.1:9200")

# 带认证
es = Elasticsearch("http://127.0.0.1:9201", basic_auth=("elastic", "123456"))

# pip install elasticsearch[async] (异步)
from elasticsearch import AsyncElasticsearch
es = AsyncElasticsearch("http://127.0.0.1:9200")
```

---

### Meilisearch

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d meilisearch

# 测试连接
curl http://127.0.0.1:7700/health
```

| 配置项 | 值 |
|--------|------|
| 端口 | 7700 |
| Master Key | masterKey123456 |
| 数据目录 | `/Volumes/T7/programe/env/docker/meilisearch/data` |

**Python 连接示例:**
```python
# pip install meilisearch
import meilisearch
client = meilisearch.Client('http://127.0.0.1:7700', 'masterKey123456')
```

---

## 消息队列

### RabbitMQ

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d rabbitmq
```

| 配置项 | 值 |
|--------|------|
| AMQP端口 | 5672 |
| 管理界面 | http://127.0.0.1:15672 |
| 用户名 | guest |
| 密码 | guest |
| 数据目录 | `/Volumes/T7/programe/env/docker/rabbitmq/data` |

**Python 连接示例:**
```python
# pip install pika
import pika
connection = pika.BlockingConnection(pika.ConnectionParameters(
    host='127.0.0.1',
    port=5672,
    credentials=pika.PlainCredentials('guest', 'guest')
))

# pip install aio-pika (异步)
import aio_pika
connection = await aio_pika.connect_robust("amqp://guest:guest@127.0.0.1:5672/")
```

---

## 时序数据库

### InfluxDB 2.x

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d influxdb
```

| 配置项 | 值 |
|--------|------|
| 端口 | 8086 |
| 用户名 | admin |
| 密码 | 12345678 |
| 组织 | fba |
| Bucket | fba |
| Token | my-super-secret-auth-token |
| 管理界面 | http://127.0.0.1:8086 |
| 数据目录 | `/Volumes/T7/programe/env/docker/influxdb/data` |

**Python 连接示例:**
```python
# pip install influxdb-client
from influxdb_client import InfluxDBClient
client = InfluxDBClient(
    url="http://127.0.0.1:8086",
    token="my-super-secret-auth-token",
    org="fba"
)
```

---

## 分析型数据库

### ClickHouse

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d clickhouse

# 连接
clickhouse-client -h 127.0.0.1 --port 9000 -u default --password 123456
```

| 配置项 | 值 |
|--------|------|
| HTTP端口 | 8123 |
| TCP端口 | 9000 |
| 用户名 | default |
| 密码 | 123456 |
| 数据目录 | `/Volumes/T7/programe/env/docker/clickhouse/data` |

**Python 连接示例:**
```python
# pip install clickhouse-driver
from clickhouse_driver import Client
client = Client(host='127.0.0.1', port=9000, user='default', password='123456')

# pip install clickhouse-connect
import clickhouse_connect
client = clickhouse_connect.get_client(host='127.0.0.1', port=8123, username='default', password='123456')
```

---

## 图数据库

### Neo4j

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d neo4j
```

| 配置项 | 值 |
|--------|------|
| HTTP端口 | 7474 |
| Bolt端口 | 7687 |
| 用户名 | neo4j |
| 密码 | 12345678 |
| 浏览器界面 | http://127.0.0.1:7474 |
| 数据目录 | `/Volumes/T7/programe/env/docker/neo4j/data` |

**Python 连接示例:**
```python
# pip install neo4j
from neo4j import GraphDatabase
driver = GraphDatabase.driver("bolt://127.0.0.1:7687", auth=("neo4j", "12345678"))
```

---

## 分布式数据库

### TiDB (MySQL 兼容)

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d tidb

# 连接 (使用 MySQL 客户端)
mysql -h 127.0.0.1 -P 4000 -u root
```

| 配置项 | 值 |
|--------|------|
| MySQL协议端口 | 4000 |
| 状态端口 | 10080 |
| 用户名 | root |
| 密码 | 无 |
| 数据目录 | `/Volumes/T7/programe/env/docker/tidb/data` |

**Python 连接示例:**
```python
# 使用 MySQL 驱动
DATABASE_URL = "mysql+pymysql://root@127.0.0.1:4000/fba?charset=utf8mb4"
```

---

### CockroachDB (PostgreSQL 兼容)

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d cockroachdb

# 连接 (使用 PostgreSQL 客户端)
psql -h 127.0.0.1 -p 26257 -U root -d defaultdb
```

| 配置项 | 值 |
|--------|------|
| PostgreSQL端口 | 26257 |
| 管理界面 | http://127.0.0.1:8088 |
| 用户名 | root |
| 数据目录 | `/Volumes/T7/programe/env/docker/cockroachdb/data` |

**Python 连接示例:**
```python
# 使用 PostgreSQL 驱动
DATABASE_URL = "postgresql://root@127.0.0.1:26257/defaultdb?sslmode=disable"
```

---

### Cassandra

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d cassandra

# 连接
cqlsh 127.0.0.1 9042 -u cassandra -p cassandra
```

| 配置项 | 值 |
|--------|------|
| CQL端口 | 9042 |
| 用户名 | cassandra |
| 密码 | cassandra |
| 数据目录 | `/Volumes/T7/programe/env/docker/cassandra/data` |

**Python 连接示例:**
```python
# pip install cassandra-driver
from cassandra.cluster import Cluster
from cassandra.auth import PlainTextAuthProvider
auth = PlainTextAuthProvider(username='cassandra', password='cassandra')
cluster = Cluster(['127.0.0.1'], port=9042, auth_provider=auth)
session = cluster.connect()
```

---

## 对象存储

### MinIO (S3 兼容)

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d minio
```

| 配置项 | 值 |
|--------|------|
| API端口 | 9002 |
| Console端口 | 9001 |
| 控制台 | http://127.0.0.1:9001 |
| Access Key | minioadmin |
| Secret Key | minioadmin123 |
| 数据目录 | `/Volumes/T7/programe/env/docker/minio/data` |

**Python 连接示例:**
```python
# pip install minio
from minio import Minio
client = Minio(
    "127.0.0.1:9002",
    access_key="minioadmin",
    secret_key="minioadmin123",
    secure=False
)

# 使用 boto3 (S3 兼容)
# pip install boto3
import boto3
s3 = boto3.client(
    's3',
    endpoint_url='http://127.0.0.1:9002',
    aws_access_key_id='minioadmin',
    aws_secret_access_key='minioadmin123'
)
```

---

## 向量数据库

### Milvus

```bash
# 启动 (会同时启动 etcd 和 minio)
docker-compose -f docker-compose-database.yml up -d milvus-standalone
```

| 配置项 | 值 |
|--------|------|
| gRPC端口 | 19530 |
| Metrics端口 | 9091 |
| 数据目录 | `/Volumes/T7/programe/env/docker/milvus/data` |

**Python 连接示例:**
```python
# pip install pymilvus
from pymilvus import connections
connections.connect("default", host="127.0.0.1", port="19530")
```

---

### Qdrant

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d qdrant
```

| 配置项 | 值 |
|--------|------|
| HTTP端口 | 6333 |
| gRPC端口 | 6334 |
| Dashboard | http://127.0.0.1:6333/dashboard |
| 数据目录 | `/Volumes/T7/programe/env/docker/qdrant/data` |

**Python 连接示例:**
```python
# pip install qdrant-client
from qdrant_client import QdrantClient
client = QdrantClient(host="127.0.0.1", port=6333)
```

---

### Chroma

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d chroma
```

| 配置项 | 值 |
|--------|------|
| HTTP端口 | 8001 |
| 数据目录 | `/Volumes/T7/programe/env/docker/chroma/data` |

**Python 连接示例:**
```python
# pip install chromadb
import chromadb
client = chromadb.HttpClient(host="127.0.0.1", port=8001)
```

---

### Weaviate

```bash
# 启动
docker-compose -f docker-compose-database.yml up -d weaviate
```

| 配置项 | 值 |
|--------|------|
| HTTP端口 | 8087 |
| gRPC端口 | 50051 |
| 数据目录 | `/Volumes/T7/programe/env/docker/weaviate/data` |

**Python 连接示例:**
```python
# pip install weaviate-client
import weaviate
client = weaviate.Client("http://127.0.0.1:8087")
```

---

## 数据库管理工具

### Adminer (通用数据库管理)

```bash
docker-compose -f docker-compose-database.yml up -d adminer
```

| 配置项 | 值 |
|--------|------|
| 访问地址 | http://127.0.0.1:8081 |
| 支持数据库 | MySQL, PostgreSQL, SQLite, MongoDB 等 |

---

### phpMyAdmin (MySQL 管理)

```bash
docker-compose -f docker-compose-database.yml up -d mysql phpmyadmin
```

| 配置项 | 值 |
|--------|------|
| 访问地址 | http://127.0.0.1:8082 |

---

### pgAdmin (PostgreSQL 管理)

```bash
docker-compose -f docker-compose-database.yml up -d postgres pgadmin
```

| 配置项 | 值 |
|--------|------|
| 访问地址 | http://127.0.0.1:8083 |
| 邮箱 | admin@admin.com |
| 密码 | admin123 |

---

### Mongo Express (MongoDB 管理)

```bash
docker-compose -f docker-compose-database.yml up -d mongodb mongo-express
```

| 配置项 | 值 |
|--------|------|
| 访问地址 | http://127.0.0.1:8084 |
| 用户名 | admin |
| 密码 | admin123 |

---

### Redis Commander (Redis 管理)

```bash
docker-compose -f docker-compose-database.yml up -d redis redis-commander
```

| 配置项 | 值 |
|--------|------|
| 访问地址 | http://127.0.0.1:8085 |

---

### Kibana (Elasticsearch 管理)

```bash
docker-compose -f docker-compose-database.yml up -d elasticsearch kibana
```

| 配置项 | 值 |
|--------|------|
| 访问地址 | http://127.0.0.1:5601 |

---

## 常用组合部署

### Web 应用开发套件
```bash
docker-compose -f docker-compose-database.yml up -d postgres redis
```

### 全文搜索套件
```bash
docker-compose -f docker-compose-database.yml up -d postgres elasticsearch kibana
```

### 微服务套件
```bash
docker-compose -f docker-compose-database.yml up -d postgres redis rabbitmq mongodb
```

### AI/向量搜索套件
```bash
docker-compose -f docker-compose-database.yml up -d postgres redis qdrant
```

### 数据分析套件
```bash
docker-compose -f docker-compose-database.yml up -d postgres clickhouse influxdb
```

### 完整开发环境
```bash
docker-compose -f docker-compose-database.yml up -d postgres redis mongodb elasticsearch minio
```

---

## 端口一览表

| 服务 | 端口 | 用途 |
|------|------|------|
| MySQL | 3306 | MySQL 主端口 |
| MariaDB | 3307 | MariaDB 主端口 |
| PostgreSQL | 5432 | PostgreSQL 主端口 |
| MongoDB | 27017 | MongoDB 主端口 |
| Redis | 6379 | Redis 无密码 |
| Redis Auth | 6380 | Redis 带密码 |
| Memcached | 11211 | Memcached 主端口 |
| Elasticsearch | 9200/9300 | ES HTTP/TCP |
| Elasticsearch Secure | 9201/9301 | ES 安全版 HTTP/TCP |
| Meilisearch | 7700 | Meilisearch 主端口 |
| RabbitMQ | 5672/15672 | AMQP/管理界面 |
| InfluxDB | 8086 | InfluxDB 主端口 |
| ClickHouse | 8123/9000 | HTTP/TCP |
| Neo4j | 7474/7687 | HTTP/Bolt |
| TiDB | 4000/10080 | MySQL协议/状态 |
| CockroachDB | 26257/8088 | PostgreSQL协议/管理界面 |
| Cassandra | 9042 | CQL 端口 |
| MinIO | 9001/9002 | Console/API |
| Milvus | 19530/9091 | gRPC/Metrics |
| Qdrant | 6333/6334 | HTTP/gRPC |
| Chroma | 8001 | HTTP 端口 |
| Weaviate | 8087/50051 | HTTP/gRPC |
| Adminer | 8081 | 管理界面 |
| phpMyAdmin | 8082 | 管理界面 |
| pgAdmin | 8083 | 管理界面 |
| Mongo Express | 8084 | 管理界面 |
| Redis Commander | 8085 | 管理界面 |
| Kibana | 5601 | 管理界面 |

---

## 故障排查

### 查看容器日志
```bash
docker-compose -f docker-compose-database.yml logs -f <service_name>
```

### 进入容器
```bash
docker exec -it fba_<service_name> /bin/bash
# 或
docker exec -it fba_<service_name> /bin/sh
```

### 重启服务
```bash
docker-compose -f docker-compose-database.yml restart <service_name>
```

### 清理数据重建
```bash
docker-compose -f docker-compose-database.yml down <service_name>
rm -rf /Volumes/T7/programe/env/docker/<service_name>/data
docker-compose -f docker-compose-database.yml up -d <service_name>
```

### 查看容器资源使用
```bash
docker stats fba_<service_name>
```
